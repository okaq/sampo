<!DOCTYPE html>
<html lang="en">
    <head id="zeta">
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <meta name="viewport" content="width=1920,height=1080,initial-scale=1" />
        <meta name="source" content="https://github.com/okaq/sampo" />
        <meta name="author" content="AQ<aq@okaq.com>" />
        <meta name="date" content="2018-03-28" />
        <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAMklEQVR4nGL5n9DAQEvARFPTRy0YtWDUglELRi0YtWDUglELRi0YtWDUAioCQAAAAP//YokCIkykmBgAAAAASUVORK5CYII=" />
        <style type="text/css">
            html,body{width:1920px;overflow:auto;height:1080px;margin:0px;border:0px;padding:0px;background-color:rgba(0,0,0,0);}
        </style>
        <script type="text/javascript">
            // ok
            console.log("okaq amo damaru ok!");
            // async load
            (function() {
                var a = {
                    "load": function(e) {
                        console.log(e);
                        g.init();
                    }
                }
                document.addEventListener("DOMContentLoaded", a.load, false);
            })();
// game
var g = {
        "init": function() {
            var t0 = window.performance.now();
            console.log("do damaru");

            // subs
            g.subs = [dom,sce,db];
            g.subs.forEach(function(el){el.init();});

            window.setTimeout(g.start, 1000);

            // stats
            console.log("total render time: " + (window.performance.now() - t0) + "ms.");
        },
        "start": function() {
            g.tick = 0;

            ren.clear();

            g.tick = 0;
            g.max = (Math.random() * 1024) >>> 0;
            g.id = window.setInterval(g.frame, 1000);
        },
        "frame": function() {
            console.log("drawing rand rect #" + g.tick + " out of " + g.max);
            // sce.step();
            // ren.step();

            // add box to list
            db.tock();
            console.log(db.a[0]);

            // add to dom
            sce.port();

            // render border
            ren.marg();

            // setup the meteor

            g.tick = g.tick + 1;
            if (g.tick >= g.max) {
                console.log("rand rect done!");
                window.clearInterval(g.id);
            }
        }
    }
// data
var db = {
    "init": function() {
        // triangle list
        db.a = [];
    },
    "geom": function(s0) {
        // input square
        // output random layout
        var w0 = (1920 - s0) >>> 0;
        var h0 = (1080 - s0) >>> 0;
        var x0 = (Math.random() * w0) >>> 0;
        var y0 = (Math.random() * h0) >>> 0;
        // var r0 = [w0,h0,x0,y0];
        var r0 = [s0,s0,x0,y0];
        return r0;
    },
    "tock": function() {
        // static update of rect per frame
        db.a[0] = db.geom(512);
    },
    "met": function() {
        // angle
        db.b = {};
        // db.b.a = (Math.random() * Math.PI);
        db.b.a = [];
        db.b.a[0] = (Math.random() * Math.PI);
        // radius
        // db.b.r = (Math.random() * (512 / 2)) >>> 0;
        db.b.r = [];
        db.b.r[0] = (Math.random() * {512 / 2}) >>> 0;

        // random walk for r, theta
        // as we walk around the circle

        // methods for cartesian polar transform
    },
    "step": function() {
        // tick indicies
        var i0 = g.tick + 1;
        var i1 = db.b.a.length - 1;
        // last radius
        var r0 = db.b.a[i1];
        // radius delta
        var r1 = (512 / 16) >>> 0;
        // radius step
        var r2 = (Math.random() * r1) >>> 0;
        // pos neg flip
        var r3 = Math.random();
        var r4 = 1.0;
        if (r3 <= 0.5) {
            r4 = -1.0;
        }
        // jump dist
        var r5 = (r2 * r4);
        var r6 = (r0 + r5) >>> 0;
        // floor
        if (r6 < 0) {
            r6 = -1.0 * r6;
        }
        if (r6 >= 512) {
            r6 = 512 - (r6 - 512);
        }
        db.b.a.push(r6);
    },
    "step2": function() {
        // angle walk
    }
}
// render
var ren = {
    "clear": function() {
        var c0 = sce.a.c;
        c0.con.fillStyle = sce.a.d;
        c0.con.fillRect(0,0,c0.can.width,c0.can.height);
    },
    "step": function() {
        var c0 = sce.b[g.tick].c;
        var d0 = sce.b[g.tick].d
        c0.con.fillStyle = d0;
        c0.con.fillRect(0,0,c0.can.width,c0.can.height);
    },
    "marg": function() {
        var c0 = sce.b[0].c;
        c0.con.strokeStyle = rgba.css([0,0,0,1.0]);
        c0.con.lineWidth = 16;
        c0.con.strokeRect(0,0,c0.can.width,c0.can.height);
    }
}
    // scene
    var sce = {
        "init": function() {
            // bkgd
            sce.a = {};
            sce.a.r = [1920,1080,0,0];
            sce.a.c = dom.canvas(sce.a.r);
            sce.a.d = rgba.rmon();

            dom.add(sce.a.c);

            // rand list
            sce.b = [];
        },
        "step": function() {
            // add rand rect
            // origin
            var x0 = (Math.random() * 1920) >>> 0;
            var y0 = (Math.random() * 1080) >>> 0;
            // dims
            var w0 = (1920 - x0) >>> 0;
            var h0 = (1080 - y0) >>> 0;
            var w1 = (Math.random() * w0);
            var h1 = (Math.random() * h0);
            // rect
            var r0 = {};
            r0.r = [w1,h1,x0,y0];
            r0.c = dom.canvas(r0.r);
            r0.d = rgba.rmon();

            sce.b[g.tick] = r0;
            dom.add(sce.b[g.tick].c);

            // no need for z-index
            // rects rendered and displayed
            // in canvas add order
        },
        "port": function() {
            // add the current rect to the dom
            sce.b[0] = {};
            sce.b[0].r = db.a[0];
            sce.b[0].c = dom.canvas(sce.b[0].r);
            sce.b[0].d = rgba.rmon();

            dom.add(sce.b[0].c);
        }
    }
        // dom
        var dom = {
            "init": function() {
                dom.alpha = document.getElementById("alpha");
                console.log(dom.alpha);
            },
            "canvas": function(r0) {
                var c0 = {};
                c0.can = document.createElement("canvas");
                c0.con = c0.can.getContext("2d");
                c0.can.width = r0[0];
                c0.can.height = r0[1];
                c0.can.style.position = "absolute";
                c0.can.style.top = r0[3] + "px";
                c0.can.style.left = r0[2] + "px";
                return c0;
            },
            "add": function(c0) {
                dom.alpha.appendChild(c0.can);
            },
            "remove": function(c0) {
                dom.alpha.removeChild(c0.can);
            }
        }
        // colors
        var rgba = {
            "rc": function() {
                // return random rgba
                var c0 = [
                    rgba.rb(),
                    rgba.rb(),
                    rgba.rb(),
                    1.0
                    ];
                return c0;
            },
            "css": function(c0) {
                // return css string
                return "rgba(" + c0.join(",") + ")";
            },
            "rb": function() {
                // random byte
                return (Math.random() * 255) >>> 0;
            },
            "rba": function(size0) {
                // random byte array length of input
                var r0 = [];
                for (var i = 0; i < size0; i++) {
                    r0.push(rgba.rb());
                }
                return r0;
            },
            "rand": function() {
                return rgba.css(rgba.rc());
            },
            "mono": function(c0) {
                return rgba.css([c0,c0,c0,1.0]);
            },
            "rmon": function() {
                var c0 = rgba.rb();
                return rgba.mono(c0);
            }
        }
                </script>
            </head>
            <body id="alpha">
            </body>
        </html>
